<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="Author" content="Apple Inc." />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="icon" href="/favicon.ico" />
<link rel="stylesheet" href="http://www.apple.com/wss/fonts?family=Myriad+Set+Pro&v=1" type="text/css" />

<link rel="stylesheet" href="https://devimages.apple.com.edgekey.net/assets/core/styles/base.css" type="text/css" />
<link rel="stylesheet" href="/assets/core/styles/templates.css" type="text/css" />
<link rel="stylesheet" href="/assets/core/styles/responsify.css" type="text/css" />
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/lib/prototype.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/lib/scriptaculous.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/browserdetect.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/apple_core.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/search_decorator.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/core/scripts/adc_core.js" type="text/javascript" charset="utf-8"></script>
<script src="https://devimages.apple.com.edgekey.net/assets/scripts/ac_retina.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	document.write('<link rel="stylesheet" type="text/css" href="https://devimages.apple.com.edgekey.net/assets/styles/script.css" media="screen">');
</script>
<!-- Augmented Search -->
<link rel="stylesheet" href="https://devimages.apple.com.edgekey.net/assets/styles/augmented_search.css" type="text/css">
<script src="https://devimages.apple.com.edgekey.net/assets/scripts/lib/jquery/jquery-1.11.0.min.js"></script>
<script>jQuery.noConflict();</script>
<script src="https://devimages.apple.com.edgekey.net/assets/scripts/augmented_search.js"></script>
	<title>What Happened to  NSMethodSignature ? - Swift Blog - Apple Developer</title>
	<meta name="omni-page" content="What Happened to  NSMethodSignature ? - Swift Blog - Apple Developer" />
	<meta name="Description" content="Get the latest news and helpful tips on the Swift programming language from the engineers who created it.">
	<link href="/swift/styles/swift.css" rel="stylesheet" type="text/css">
	<script src="/swift/scripts/swift.js" type="text/javascript" rel="stylesheet"></script>
</head>
<body class="white responsify swift-blog">
	<div id="globalheader-wrapper">
<nav id="globalheader" data-hires="true">
	
	<h1 data-hires="true"><a href="/">Apple Developer</a></h1>
	<ul id="gh-nav">
		<li id="gh-nav-technologies"><a href="/technologies/">Technologies</a></li>
		<li id="gh-nav-resources"><a href="/resources/">Resources</a></li>
		<li id="gh-nav-programs"><a href="/programs/">Programs</a></li>
		<li id="gh-nav-support"><a href="/support/">Support</a></li>
		<li id="gh-nav-membercenter"><a href="/membercenter/">Member Center</a></li>
	</ul>

	<div id="gh-search" data-hires="true">
		<form action="/search/index.php" method="get" accept-charset="utf-8"><div>
			<label for="gh-adcsearch">
				<span class="prettyplaceholder"></span>
				<input type="text" name="q" id="gh-adcsearch" class="adcsearch prettysearch augmented">
			</label>
		</div></form>
	</div>

	<script type="text/javascript">
		Event.onDOMReady(function() {
			// Get root path for Global Header Active class
			ghLocation = location.pathname.split('/')[1];
			// Make sure it doesn't try to add a file extension to the css class
			if(ghLocation.include('.')) ghLocation = ghLocation.split('.')[0];
			// Add Global Header Active State Class
			$$('body')[0].addClassName('gh-nav-'+location.pathname.split('/')[1]+'-active');
		});
	</script>
</nav>
</div>
	<div id="top">
<!-- SiteCatalyst code version: H.8. Copyright 1997-2006 Omniture, Inc. -->
<script type="text/javascript">
/* RSID: */
var s_account="appleglobal,appleusdeveloper"
</script>

<script type="text/javascript" src="https://www.apple.com/metrics/scripts/s_code_h.js"></script>
<script type="text/javascript">
s.pageName=AC.Tracking.pageName();
s.channel="www.us.developer"

/************* DO NOT ALTER ANYTHING BELOW THIS LINE ! **************/
var s_code=s.t();if(s_code)document.write(s_code)</script>
<!-- End SiteCatalyst code version: H.8. -->
</div>	<!-- - -->
<div class="swift-header-container" data-hires="true">
    <div class="swift-header">
        <p class="imagereplace">Swift: A new programming language for iOS and OS X.</p>
    </div>
</div>
<!-- - -->
	<div id="content" class="content responsify" data-hires="true">
		<section class="layout-tabs">
			<div class="tab-wrapper">
				<div class="divider"></div>
				<div class="grid3col tabs">
					<div class="column one"><a href="/swift/">Overview</a></div>
					<div class="column two active"><a href="/swift/blog/">Blog</a></div>
					<div class="column three"><a href="/swift/resources/">Resources</a></div>
				</div>
			</div>
		</section>
		<section class="blog-articles padding-bottom-40">
						<ul class="article-list">
													<li id="article-19" class="article padding-top-50 padding-bottom-50 ">
						<p class="article-date lighter">Dec 12, 2014</p>
						<h2>
														What Happened to <span class="menlo">NSMethodSignature</span>?
													</h2>

						<p class="update">UPDATE: We’ve added the Request.playground file to this post so you can download it and easily experiment with the code yourself.</p><p>Bringing the Cocoa frameworks to Swift gave us a unique opportunity to look at our APIs with a fresh perspective. We found classes that we didn't feel fit with the goals of Swift, most often due to the priority we give to safety.  For instance, some classes related to dynamic method invocation are not exposed in Swift, namely <span class="keyword">NSInvocation</span> and <span class="keyword">NSMethodSignature</span>.</p><p>We recently received a bug report from a developer who noticed this absence. This developer was using <span class="keyword">NSMethodSignature</span> in Objective-C to introspect the types of method arguments, and in the process of migrating this code to Swift, noticed that <span class="keyword">NSMethodSignature</span> is not available. The code being migrated could accept HTTP handlers of varying signatures, such as:</p><pre><code><span class="key">func</span> handleRequest(request: <span class="pointer">HTTPRequest</span>, queryStringArguments: [<span class="title">String</span>: <span class="title">String</span>]) { }
<span class="key">func</span> handleRequest(request: <span class="pointer">HTTPRequest</span>, jsonBody: <span class="title">JSON</span>) { }</code></pre><p>In Objective-C, <span class="keyword">NSMethodSignature</span> can be used to determine that the API of the first method would require a <span class="keyword">[String: String]</span> argument, and the second method would require a <span class="keyword">JSON</span> value. However, Swift is a powerful language and can easily handle this scenario without using <span class="keyword">NSMethodSignature</span>, and in a way that doesn't undermine the help that the compiler provides for type and memory safety.</p><p>Here is an alternative way to solve the same problem in Swift:</p><pre><code><span class="key">struct</span> HTTPRequest {
	<span class="comment">// ...</span>
}

<span class="key">protocol</span> HTTPHandlerType {
	<span class="key">typealias</span> Data

	<span class="comment">/// :returns: true if the request was handled; false otherwise</span>
	<span class="key">func</span> handle(request: <span class="pointer">HTTPRequest</span>, data: <span class="title">Data</span>) -&gt; <span class="title">Bool</span>
}</code></pre><p>First, we'll use a protocol to define that whatever is going to handle our <span class="keyword">HTTPRequest</span> does so via this interface. This protocol is very simple, with only a single method.</p><p>Why use a protocol here, instead of subclassing an <span class="keyword">HTTPHandler</span> class? Because protocols give the flexibility of leaving the implementation details up to the clients of this code. If we were to make an <span class="keyword">HTTPHandler</span> class, we would require clients to also use classes, forcing upon them the semantics of reference types. However, by using a protocol, clients can decide for themselves the appropriate type to use in their code, whether it be class, struct, or even enum.</p><pre><code><span class="key">class</span> HTTPServer {
	<span class="key">func</span> addHandler&lt;T: HTTPHandlerType&gt;(handler: <span class="title">T</span>) {
		handlers.append { (request: <span class="pointer">HTTPRequest</span>, args: <span class="title">Any</span>) -&gt; Bool <span class="key">in</span>
			<span class="key">if let</span> typedArgs = args <span class="key">as</span>? <span class="pointer">T</span>.<span class="title">Data</span> {
				<span class="key">return</span> handler.handle(request, data: typedArgs)
			}
			<span class="key">return false</span>
		}
	}

	<span class="comment">// ...</span>
}</code></pre><p>Next, our <span class="keyword">HTTPServer</span> class has a generic method that accepts an <span class="keyword">HTTPHandlerType</span> as a parameter. By using the handler's associated type, it can perform the conditional downcast of the <span class="keyword">args</span> parameter to determine if this handler should be given an opportunity to handle the request. Here we can see the benefit of defining <span class="keyword">HTTPHandlerType</span> as a protocol. The <span class="keyword">HTTPServer</span> doesn't need to know <em>how</em> the handler is reacting to the request, nor does it even need to care about the nature of the handler itself. All it needs to know is that the value can handle requests.</p><pre><code><span class="key">class</span> HTTPServer {
	<span class="comment">// ...</span>

	<span class="key">private var</span> handlers: [(<span class="pointer">HTTPRequest</span>, <span class="title">Any</span>) -&gt; <span class="title">Bool</span>] = []

	<span class="key">func</span> dispatch(req: <span class="pointer">HTTPRequest</span>, args: <span class="title">Any</span>) -&gt; <span class="title">Bool</span> {
		<span class="key">for</span> handler <span class="key">in</span> <span class="pointer">handlers</span> {
			<span class="key">if</span> handler(req, args) {
				<span class="key">return true</span>
			}
		}
		<span class="key">return false</span>
	}
}</code></pre><p>When our <span class="keyword">HTTPServer</span> receives a request, it will iterate through its handlers and see if any can deal with the request.</p><p>Now we can easily create a custom <span class="keyword">HTTPHandlerType</span> with varying argument types and register it with the <span class="keyword">HTTPServer</span>:</p><pre><code><span class="key">class</span> MyHandler : <span class="pointer">HTTPHandlerType</span> {
	<span class="key">func</span> handle(request: <span class="pointer">HTTPRequest</span>, data: <span class="title">Int</span>) -&gt; <span class="title">Bool</span> {
		<span class="key">return</span> data &gt; <span class="number">5</span>
	}
}

<span class="key">let</span> server = <span class="pointer">HTTPServer</span>()
<span class="pointer">server</span>.<span class="enum">addHandler</span>(<span class="pointer">MyHandler</span>())
<span class="pointer">server</span>.dispatch(<span class="pointer">HTTPRequest</span>(...), args: <span class="string">"x"</span>) <span class="comment">// returns false</span>
<span class="pointer">server</span>.dispatch(<span class="pointer">HTTPRequest</span>(...), args: <span class="number">5</span>)   <span class="comment">// returns false</span>
<span class="pointer">server</span>.dispatch(<span class="pointer">HTTPRequest</span>(...), args: <span class="number">10</span>)  <span class="comment">// returns true</span></code></pre><p>With a combination of protocols and generics, we have written Swift code to elegantly create and register HTTP handlers of varying types. This approach also lets the compiler guarantee type safety, while ensuring excellent runtime performance.</p>

						
												<ul class="links small padding-top-20">
														<li class="download"><a href="/swift/blog/downloads/Request.zip">Request.playground</a></li>
													</ul>
						

												<a class="arrow arrow-left" href="http://developer.apple.com/swift/blog/#article-19">All Blog Posts</a>
											</li>
											</section>
	</div><!-- /content -->
	<div id="globalfooter-wrapper">
		<footer id="globalfooter">
			<div id="breadory">
				<ol id="breadcrumbs">
					<li class="home"><a href="/">Developer</a></li>
					<li><a href="/swift/">Swift</a></li>
										<li><a href="/swift/blog/">Blog</a></li>
					<li>What Happened to <span class="menlo">NSMethodSignature</span>?</li>
									</ol>
			</div><!--/breadory-->
			<p class="gf-buy">Shop the <a href="http://www.apple.com/store/">Apple Online Store</a> (1-800-MY-APPLE), visit an <a href="http://www.apple.com/retail/">Apple Retail Store</a>, or find a <a href="http://www.apple.com/buy/locator/">reseller</a>.</p>
<ul class="gf-links piped">
	<li><a href="/news/" class="first">News</a></li>
	<li><a href="/register/">Register</a></li>
	<li><a href="/bug-reporting/">Report Bugs</a></li>
	<li><a href="/contact/">Contact Us</a></li>
</ul>
<div class="gf-sosumi">
	<p>Copyright © 2014 Apple Inc. All rights reserved.</p>
	<ul class="piped">
		<li><a href="http://www.apple.com/legal/internet-services/terms/site.html" class="first">Terms of Use</a></li>
		<li><a href="http://www.apple.com/privacy/">Privacy Policy</a></li>
	</ul>
</div>
<div id="localization-links">
	<ul>
		<li><a href="/cn/" title="Simplified Chinese">简体中文</a></li>
		<li><a href="/jp/" title="Japanese">日本語</a></li>
		<li><a href="/kr/" title="Korean">한국어</a></li>
	</ul>
</div>		</footer><!--/globalfooter-->
	</div><!-- /globalfooter-wrapper -->
</body>
</html>